FROM rust:1

WORKDIR /app

# System deps
RUN apt-get update && apt-get install -y \
    curl \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Rust wasm target
RUN rustup target add wasm32-unknown-unknown

# Node + Tailwind
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && npm install -g tailwindcss

# Dioxus CLI
RUN curl -L --proto '=https' --tlsv1.2 -sSf \
    https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh | bash && \
    cargo binstall dioxus-cli -y --force

ENV PATH="/root/.cargo/bin:$PATH"

COPY dev.sh /usr/local/bin/dev.sh
RUN chmod +x /usr/local/bin/dev.sh

EXPOSE 8080

CMD ["dev.sh"]
